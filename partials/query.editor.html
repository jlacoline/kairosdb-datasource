<query-editor-row query-ctrl="ctrl" can-collapse="false">
  <div class="gf-form-inline">
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-7"> Metric </label>
      <input type="text" class="gf-form-input width-24"
        ng-model="ctrl.target.metric"
        spellcheck="false"
        bs-typeahead="ctrl.suggestMetrics"
        placeholder="metric name"
        data-min-length=0 data-items=100
        ng-blur="ctrl.targetBlur()"> </input>
      <a bs-tooltip="ctrl.target.errors.metric" class="gf-form-label"
        style="color: rgb(229, 189, 28)"
        ng-show="ctrl.target.errors.metric">
        <i class="fa fa-warning"></i>
      </a>
      <label class="gf-form-label">
        &nbsp;Peak filter
        <input class="input-medium" type="checkbox" ng-model="ctrl.target.exOuter" ng-change="ctrl.targetBlur()">
      </label>
    </div>
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

  <!-- TAGS -->
  <div class="gf-form-inline">
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-7"> Tags </label>
    </div>
    <div class="gf-form" ng-repeat="(key, value) in ctrl.target.tags track by $index">
      <div class="gf-form-label query-part">
          {{key}}&nbsp;=&nbsp;{{value}}
          <a ng-click="ctrl.removeFilterTag(key)">
            <i class="fa fa-remove"></i>
          </a>
      </div>
    </div>
    <div class="gf-form">
      <div class="gf-form-label" ng-hide="ctrl.target.addFilterTagMode">
        <a ng-click="ctrl.addFilterTag()" class="">
          <i class="fa fa-plus"></i>
        </a>
      </div>
    </div>
    <div class="gf-form" ng-show="ctrl.target.addFilterTagMode">
      <input type="text"
        class="gf-form-input width-10"
        spellcheck='false'
        bs-typeahead="ctrl.suggestTagKeys"
        ng-change="ctrl.validateFilterTag()"
        data-min-length=0 data-items=100
        ng-model="ctrl.target.currentTagKey"
        placeholder="key">
      <input type="text"
        class="gf-form-input width-13"
        spellcheck='false'
        bs-typeahead="ctrl.suggestTagValues"
        ng-change="ctrl.validateFilterTag()"
        data-min-length=0 data-items=100
        ng-model="ctrl.target.currentTagValue"
        placeholder="value">
      <a bs-tooltip="target.errors.tags" class="gf-form-label"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.tags">
        <i class="fa fa-warning"></i>
      </a>
      <div class="gf-form-label">
        <a ng-click="ctrl.addFilterTag()">
          <i ng-show="ctrl.target.errors.tags" class="fa fa-remove"></i>
          <i ng-hide="ctrl.target.errors.tags" class="fa fa-plus-circle"></i>
        </a>
      </div>
    </div>
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

  <!-- GROUP BY -->
  <div class="gf-form-inline">
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-7"> Group by </label>
    </div>
    <div class="gf-form">
      <div class="gf-form-label query-keyword" ng-show="ctrl.target.groupByTags"> Tags: </div>
      <div ng-repeat="key in ctrl.target.groupByTags track by $index" class="gf-form-label query-part">
        {{key}}
        <a ng-click="ctrl.removeGroupByTag($index)">
          <i class="fa fa-remove"></i>
        </a>
      </div>
    </div>
    <div class="gf-form">
      <div class="gf-form-label query-keyword" ng-show="ctrl.target.groupByTags && ctrl.target.nonTagGroupBys"> And by: </div>
      <div ng-repeat="groupByObject in ctrl.target.nonTagGroupBys track by $index" class="gf-form-label query-part">
        {{ctrl.getValuesOfGroupBy(groupByObject)}}
        <a ng-click="ctrl.removeNonTagGroupBy($index)">
          <i class="fa fa-remove"></i>
        </a>
      </div>
    </div>
    <div class="gf-form">
      <div class="gf-form-label" ng-hide="ctrl.target.addGroupByMode">
        <a ng-click="ctrl.addGroupBy()">
          <i class="fa fa-plus"></i>
        </a>
      </div>
    </div>
    <div class="gf-form">
      <div class="gf-form-select-wrapper width-8" ng-show="ctrl.target.addGroupByMode">
        <select class="gf-form-input"
          ng-change="ctrl.changeGroupByInput()"
          ng-model="ctrl.target.currentGroupByType"
          ng-options="f for f in ['tag','value','time']"></select>
      </div>
      <input type="text"
      class="gf-form-input width-10"
      spellcheck='false'
      bs-typeahead="ctrl.suggestTagKeys"
      ng-change = "ctrl.validateGroupBy()"
      data-min-length=0 data-items=100
      ng-model="ctrl.target.groupBy.tagKey"
      ng-show="ctrl.target.isTagGroupBy"
      placeholder="key">
      <a class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy.tagKey"
        style="color: rgb(229, 189, 28)"
        ng-show="ctrl.target.isTagGroupBy && ctrl.target.errors.groupBy.tagKey">
        <i class="fa fa-warning"></i>
      </a>
      <input type="text"
      class="gf-form-input width-6"
      spellcheck='false'
      ng-model="ctrl.target.groupBy.valueRange"
      placeholder="range"
      bs-tooltip="'Range on which values are considered in the same group'"
      ng-show="ctrl.target.isValueGroupBy"
      ng-change = "ctrl.validateGroupBy()" >
      <a class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy.valueRange"
        style="color: rgb(229, 189, 28)"
        ng-show="ctrl.target.isValueGroupBy && ctrl.target.errors.groupBy.valueRange">
        <i class="fa fa-warning"></i>
      </a>
      <input type="text"
      class="gf-form-input width-4"
      ng-model="ctrl.target.groupBy.timeInterval"
      ng-init="ctrl.target.groupBy.timeInterval='1s'"
      placeholder="interval"
      bs-tooltip="'Duration of time groups'"
      spellcheck='false'
      ng-show="ctrl.target.isTimeGroupBy"
      ng-change="ctrl.validateGroupBy()">
      <a class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy.timeInterval"
        style="color: rgb(229, 189, 28)"
        ng-show="ctrl.target.isTimeGroupBy && ctrl.target.errors.groupBy.timeInterval">
        <i class="fa fa-warning"></i>
      </a>
      <input type="text"
      class="gf-form-input width-4"
      ng-model="ctrl.target.groupBy.groupCount"
      placeholder="Count"
      bs-tooltip="'Number of time groups to be formed'"
      spellcheck='false'
      ng-show="ctrl.target.isTimeGroupBy"
      ng-change="ctrl.validateGroupBy()">
      <a class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy.groupCount"
        style="color: rgb(229, 189, 28)"
        ng-show="ctrl.target.isTimeGroupBy && ctrl.target.errors.groupBy.groupCount">
        <i class="fa fa-warning"></i>
      </a>
      <div class="gf-form-label" ng-show="ctrl.target.addGroupByMode">
        <a ng-click="ctrl.addGroupBy()">
          <i ng-hide="ctrl.target.isGroupByValid" class="fa fa-remove"></i>
          <i ng-show="ctrl.target.isGroupByValid" class="fa fa-plus-circle"></i>
        </a>
      </div>
    </div>  
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

  <!-- HORIZONTAL AGGREGATION -->
  <div class="gf-form-inline">
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-7"> Aggregators </label>
    </div>
    <div class="gf-form">
      <div class="gf-form-label query-part" ng-repeat="aggregatorObject in ctrl.target.horizontalAggregators track by $index">
        {{aggregatorObject.name}}&#40;
        <span ng-repeat="val in aggregatorObject">
            {{val != aggregatorObject.name ? val : ''}}
        </span>
        &#41;
        <a ng-click="ctrl.removeHorizontalAggregator($index)">
          <i class="fa fa-remove"></i>
        </a>
      </div>

      <div class="gf-form-label" ng-hide="ctrl.target.addHorizontalAggregatorMode">
        <a ng-click="ctrl.addHorizontalAggregator()">
          <i class="fa fa-plus"></i>
        </a>
      </div>
    </div>
    <div class="gf-form">
      <div class="gf-form-select-wrapper" ng-show="ctrl.target.addHorizontalAggregatorMode">
        <select class="gf-form-input width-10"
          ng-change="ctrl.changeHorAggregationInput()"
          ng-model="ctrl.target.currentHorizontalAggregatorName"
          ng-options="f for f in ['avg','dev','max','min','rate','sampler','count','sum','least_squares','percentile','scale','div', 'first', 'gaps', 'last', 'diff']"></select>
      </div>

      <!-- Different parameters -->
      <div ng-show="ctrl.target.hasSamplingRate" class="gf-form-label">
        every
      </div>
      <div ng-show="ctrl.target.hasSamplingRate">
        <input type="text"
        class="gf-form-input width-5"
        ng-model="ctrl.target.horAggregator.samplingRate"
        ng-init="ctrl.target.horAggregator.samplingRate='1s'"
        spellcheck='false'
        ng-change="ctrl.validateHorizontalAggregator()" >
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.horAggregator.samplingRate"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.horAggregator.samplingRate">
          <i class="fa fa-warning"></i>
        </a>
      </div>

      <div ng-show="ctrl.target.hasUnit" class="gf-form-label">
        every
      </div>
      <div class="gf-form-select-wrapper" ng-show="ctrl.target.hasUnit">
        <select class="gf-form-input width-9"
          ng-model="ctrl.target.horAggregator.unit"
          ng-init="ctrl.target.horAggregator.unit='millisecond'"
          ng-options="f for f in ['millisecond','second','minute','hour','day','week','month','year']"></select>
      </div>

      <div ng-show="ctrl.target.hasFactor" class="gf-form-label">
        by
      </div>
      <div ng-show="ctrl.target.hasFactor">
        <input type="text"
        class="gf-form-input width-4"
        ng-model="ctrl.target.horAggregator.factor"
        ng-init="ctrl.target.horAggregator.factor='1'"
        spellcheck='false'
        ng-change="ctrl.validateHorizontalAggregator()" >
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.horAggregator.factor"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.horAggregator.factor">
          <i class="fa fa-warning"></i>
        </a>
      </div>

      <div ng-show="ctrl.target.hasPercentile" class="gf-form-label">
        percentile
      </div>
      <div ng-show="ctrl.target.hasPercentile">
        <input type="text"
        class="gf-form-input width-4"
        ng-model="ctrl.target.horAggregator.percentile"
        ng-init="ctrl.target.horAggregator.percentile='0.75'"
        spellcheck='false'
        ng-change="ctrl.validateHorizontalAggregator()" >
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.horAggregator.percentile"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.horAggregator.percentile">
          <i class="fa fa-warning"></i>
        </a>
      </div>

      <div class="gf-form-label" ng-show="ctrl.target.addHorizontalAggregatorMode">
        <a ng-click="ctrl.addHorizontalAggregator()">
          <i ng-hide="ctrl.target.isAggregatorValid" class="fa fa-remove"></i>
          <i ng-show="ctrl.target.isAggregatorValid" class="fa fa-plus-circle"></i>
        </a>
      </div>
    </div>
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

  <!-- ALIAS -->
  <div class="gf-form-inline">
    <div class="gf-form">
      <div class="gf-form-label query-keyword width-7">Alias</div>
      <div class="gf-form-select-wrapper">
        <select class="gf-form-input width-8 ng-pristine ng-valid ng-not-empty" ng-change="ctrl.targetBlur()" 
          ng-model="ctrl.target.aliasMode" ng-options="o for o in ['default', 'custom']"> </select>
      </div>
      <input type="text" class="gf-form-input width-25" ng-model="ctrl.target.alias"
        spellcheck='false' ng-blur="ctrl.targetBlur()" ng-readonly="ctrl.target.aliasMode!='custom'">
      <div class="gf-form-label">
        <i class="fa fa-question-circle ng-scope text-left" data-placement="right" data-html="true"
           bs-tooltip="'Expression used for metric and group aliasing <br />
           The following variables are available to differentiate the data groups: <br />
           $_tag_group_[tag name] -> The tag\'s value in a tag groupby <br />
           $_value_group_[n] -> The group number in the nth value groupby <br />
           $_time_group_[n] -> The group number in the nth time groupby <br />'">
        </i>
      </div>
    </div>
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

</query-editor-row>


