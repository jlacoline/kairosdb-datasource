<query-editor-row query-ctrl="ctrl" can-collapse="false">
  <div class="gf-form-inline">
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-9"> METRIC </label>
      <input type="text" class="gf-form-input"
        ng-model="ctrl.target.metric"
        spellcheck="false"
        bs-typeahead="ctrl.suggestMetrics"
        placeholder="metric name"
        data-min-length=0 data-items=100
        ng-blur="ctrl.targetBlur()"> </input>
      <a bs-tooltip="ctrl.target.errors.metric" class="gf-form-label"
        style="color: rgb(229, 189, 28)"
        ng-show="ctrl.target.errors.metric">
        <i class="fa fa-warning"></i>
      </a>
      <label class="gf-form-label"> Alias </label>
      <input type="text" class="gf-form-input" ng-model="ctrl.target.alias"
      spellcheck='false' placeholder="alias" ng-blur="ctrl.targetBlur()">
      <label class="gf-form-label">
        &nbsp;Peak filter
        <input class="input-medium" type="checkbox" ng-model="ctrl.target.exOuter" ng-change="ctrl.targetBlur()">
      </label>
    </div>
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

  <!-- TAGS -->
  <div class="gf-form-inline">
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-9"> TAGS </label>
      <div ng-repeat="(key, value) in ctrl.target.tags track by $index" class="gf-form-label query-part">
          {{key}}&nbsp;=&nbsp;{{value}}
          <a ng-click="ctrl.removeFilterTag(key)">
            <i class="fa fa-remove"></i>
          </a>
      </div>
  
      <div class="gf-form-label" ng-hide="ctrl.target.addFilterTagMode">
        <a ng-click="ctrl.addFilterTag()" class="">
          <i class="fa fa-plus"></i>
        </a>
      </div>
      <div class="gf-form" ng-show="ctrl.target.addFilterTagMode">
        <input type="text"
        class="input-small gf-form-input"
        spellcheck='false'
        bs-typeahead="ctrl.suggestTagKeys"
        ng-change="ctrl.validateFilterTag()"
        data-min-length=0 data-items=100
        ng-model="ctrl.target.currentTagKey"
        placeholder="key">
        <input type="text"
        class="input-small gf-form-input"
        spellcheck='false'
        bs-typeahead="ctrl.suggestTagValues"
        ng-change="ctrl.validateFilterTag()"
        data-min-length=0 data-items=100
        ng-model="ctrl.target.currentTagValue"
        placeholder="value">
        <a bs-tooltip="target.errors.tags" class="gf-form-label"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.tags">
          <i class="fa fa-warning"></i>
        </a>
        <div class="gf-form-label">
          <a ng-click="ctrl.addFilterTag()">
            <i ng-show="ctrl.target.errors.tags" class="fa fa-remove"></i>
            <i ng-hide="ctrl.target.errors.tags" class="fa fa-plus-circle"></i>
          </a>
        </div>
      </div>
    </div>
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

  <!-- GROUP BY -->
  <div class="gf-form-inline">
    <div class="gf-form"> 
      <label class="gf-form-label query-keyword width-9"> GROUP BY </label>

      <div class="gf-form-label query-keyword" ng-show="ctrl.target.groupByTags"> Tags: </div>

      <div ng-repeat="key in ctrl.target.groupByTags track by $index" class="gf-form-label">
        {{key}}
        <a ng-click="ctrl.removeGroupByTag($index)">
          <i class="fa fa-remove"></i>
        </a>
      </div>

      <div class="gf-form-label query-keyword" ng-show="ctrl.target.groupByTags && ctrl.target.nonTagGroupBys"> And by: </div>

      <div ng-repeat="groupByObject in ctrl.target.nonTagGroupBys track by $index" class="gf-form-label">
        {{ctrl.getValuesOfGroupBy(groupByObject)}}
        <a ng-click="ctrl.removeNonTagGroupBy($index)">
          <i class="fa fa-remove"></i>
        </a>
      </div>

      <div class="gf-form-label" ng-hide="ctrl.target.addGroupByMode">
        <a ng-click="ctrl.addGroupBy()">
          <i class="fa fa-plus"></i>
        </a>
      </div>
      <div class="gf-form-select-wrapper" ng-show="ctrl.target.addGroupByMode">
        <select class="input-small gf-form-input"
          ng-change="ctrl.changeGroupByInput()"
          ng-model="ctrl.target.currentGroupByType"
          ng-options="f for f in ['tag','value','time']"></select>
      </div>
      <div class="gf-form" ng-show="ctrl.target.isTagGroupBy">
        <input type="text"
        class="input-small gf-form-input"
        spellcheck='false'
        bs-typeahead="ctrl.suggestTagKeys"
        ng-change = "ctrl.validateGroupBy()"
        data-min-length=0 data-items=100
        ng-model="ctrl.target.groupBy.tagKey"
        placeholder="key">
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy.tagKey"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.groupBy.tagKey">
          <i class="fa fa-warning"></i>
        </a>
      </div>
      <div class="gf-form" ng-show="ctrl.target.isValueGroupBy">
        <input type="text"
        class="input-mini gf-form-input"
        spellcheck='false'
        ng-model="ctrl.target.groupBy.valueRange"
        placeholder="range"
        bs-tooltip="'Range on which values are considered in the same group'"
        ng-change = "ctrl.validateGroupBy()" >
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy.valueRange"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.groupBy.valueRange">
          <i class="fa fa-warning"></i>
        </a>
      </div>
      <div class="gf-form" ng-show="ctrl.target.isTimeGroupBy">
        <input type="text"
        class="input-mini gf-form-input"
        ng-model="ctrl.target.groupBy.timeInterval"
        ng-init="ctrl.target.groupBy.timeInterval='1s'"
        placeholder="interval"
        bs-tooltip="'Duration of time groups'"
        spellcheck='false'
        ng-change="ctrl.validateGroupBy()">
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy.timeInterval"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.groupBy.timeInterval">
          <i class="fa fa-warning"></i>
        </a>
      </div>
      <div class="gf-form" ng-show="ctrl.target.isTimeGroupBy">
        <input type="text"
        class="input-mini gf-form-input"
        ng-model="ctrl.target.groupBy.groupCount"
        placeholder="Count"
        bs-tooltip="'Number of time groups to be formed'"
        spellcheck='false'
        ng-change="ctrl.validateGroupBy()">
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy.groupCount"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.groupBy.groupCount">
          <i class="fa fa-warning"></i>
        </a>
      </div>
      <div class="gf-form-label" ng-show="ctrl.target.addGroupByMode">
        <a ng-click="ctrl.addGroupBy()">
          <i ng-hide="ctrl.target.isGroupByValid" class="fa fa-remove"></i>
          <i ng-show="ctrl.target.isGroupByValid" class="fa fa-plus-circle"></i>
        </a>
      </div>
    </div>
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

  <!-- HORIZONTAL AGGREGATION -->
  <div class="gf-form-inline">
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-9"> AGGREGATORS </label>
      <div class="gf-form-label" ng-repeat="aggregatorObject in ctrl.target.horizontalAggregators track by $index">
        {{aggregatorObject.name}}&#40;
        <span ng-repeat="val in aggregatorObject">
            {{val != aggregatorObject.name ? val : ''}}
        </span>
        &#41;
        <a ng-click="ctrl.removeHorizontalAggregator($index)">
          <i class="fa fa-remove"></i>
        </a>
      </div>

      <div class="gf-form-label" ng-hide="ctrl.target.addHorizontalAggregatorMode">
        <a ng-click="ctrl.addHorizontalAggregator()">
          <i class="fa fa-plus"></i>
        </a>
      </div>

      <div class="gf-form-select-wrapper" ng-show="ctrl.target.addHorizontalAggregatorMode">
        <select class="input-medium gf-form-input"
          ng-change="ctrl.changeHorAggregationInput()"
          ng-model="ctrl.target.currentHorizontalAggregatorName"
          ng-options="f for f in ['avg','dev','max','min','rate','sampler','count','sum','least_squares','percentile','scale','div', 'first', 'gaps', 'last', 'diff']"></select>
      </div>

      <!-- Different parameters -->
      <div ng-show="ctrl.target.hasSamplingRate" class="gf-form-label">
        every
      </div>
      <div ng-show="ctrl.target.hasSamplingRate">
        <input type="text"
        class="input-mini gf-form-input"
        ng-model="ctrl.target.horAggregator.samplingRate"
        ng-init="ctrl.target.horAggregator.samplingRate='1s'"
        spellcheck='false'
        ng-change="ctrl.validateHorizontalAggregator()" >
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.horAggregator.samplingRate"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.horAggregator.samplingRate">
          <i class="fa fa-warning"></i>
        </a>
      </div>

      <div ng-show="ctrl.target.hasUnit" class="gf-form-label">
        every
      </div>
      <div class="gf-form-select-wrapper" ng-show="ctrl.target.hasUnit">
        <select class="input-medium gf-form-input"
          ng-model="ctrl.target.horAggregator.unit"
          ng-init="ctrl.target.horAggregator.unit='millisecond'"
          ng-options="f for f in ['millisecond','second','minute','hour','day','week','month','year']"></select>
      </div>

      <div ng-show="ctrl.target.hasFactor" class="gf-form-label">
        by
      </div>
      <div ng-show="ctrl.target.hasFactor">
        <input type="text"
        class="input-mini gf-form-input"
        ng-model="ctrl.target.horAggregator.factor"
        ng-init="ctrl.target.horAggregator.factor='1'"
        spellcheck='false'
        ng-change="ctrl.validateHorizontalAggregator()" >
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.horAggregator.factor"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.horAggregator.factor">
          <i class="fa fa-warning"></i>
        </a>
      </div>

      <div ng-show="ctrl.target.hasPercentile" class="gf-form-input">
        percentile
      </div>
      <div ng-show="ctrl.target.hasPercentile">
        <input type="text"
        class="input-mini gf-form-input"
        ng-model="ctrl.target.horAggregator.percentile"
        ng-init="ctrl.target.horAggregator.percentile='0.75'"
        spellcheck='false'
        ng-change="ctrl.validateHorizontalAggregator()" >
        <a class="gf-form-label" bs-tooltip="ctrl.target.errors.horAggregator.percentile"
          style="color: rgb(229, 189, 28)"
          ng-show="ctrl.target.errors.horAggregator.percentile">
          <i class="fa fa-warning"></i>
        </a>
      </div>

      <div class="gf-form-label" ng-show="ctrl.target.addHorizontalAggregatorMode">
        <a ng-click="ctrl.addHorizontalAggregator()">
          <i ng-hide="ctrl.target.isAggregatorValid" class="fa fa-remove"></i>
          <i ng-show="ctrl.target.isAggregatorValid" class="fa fa-plus-circle"></i>
        </a>
      </div>
    </div>
    <div class="gf-form gf-form--grow"> 
      <div class="gf-form-label gf-form-label--grow"/>
    </div>
  </div>

</query-editor-row>


